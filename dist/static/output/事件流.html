
  <!DOCTYPE html>
  <html>
  
  <head>
      <meta charset="utf-8" />
      <title>
          Zrek's blog
      </title>
      <style>
      li {
        cursor:pointer;
      }
      
      li:hover{
        background-color: #ffffff99;
      }
      
      code{
        background-color: #eee;
        padding:2px;
        display:inline-block;
      }
      
      pre{
        background-color: #eee;
        padding:10px;
        padding-left: 20px;
        padding-right: 20px;
      }
      </style>
  </head>
  
  <body style="background:#f7f7f7;">
      <div style="display:flex;width:100%;">
          <div>Zrek's blog</div>
      </div>
      <div style="display:flex;width:100%;">
          <div id="category" style="display: flex; flex-direction:column;background-color: antiquewhite; padding-right:20px; flex-shrink:0;">
          <ul><li>CI CD<ul><li onclick="location.href='CI CD/Github&Gitlab-CI&CD理解.html';">Github&Gitlab-CI&CD理解</li><li onclick="location.href='CI CD/构建优化.html';">构建优化</li></ul></li><li onclick="location.href='FromBD.html';">FromBD</li><li onclick="location.href='Github&Gitlab-CI&CD理解.html';">Github&Gitlab-CI&CD理解</li><li>archive<ul></ul></li><li>cs<ul><li>android<ul><li onclick="location.href='cs/android/holder.html';">holder</li></ul></li><li>llvm<ul><li onclick="location.href='cs/llvm/holder.html';">holder</li></ul></li><li>project<ul><li onclick="location.href='cs/project/holder.html';">holder</li></ul></li><li>system<ul><li onclick="location.href='cs/system/holder.html';">holder</li></ul></li></ul></li><li>java jvm android<ul><li onclick="location.href='java jvm android/Activity启动模式理解.html';">Activity启动模式理解</li><li onclick="location.href='java jvm android/ConcurrentHashMap理解.html';">ConcurrentHashMap理解</li><li onclick="location.href='java jvm android/Dex文件理解.html';">Dex文件理解</li><li onclick="location.href='java jvm android/Glide理解.html';">Glide理解</li><li onclick="location.href='java jvm android/HashMap理解.html';">HashMap理解</li><li onclick="location.href='java jvm android/JVM内存模型.html';">JVM内存模型</li><li onclick="location.href='java jvm android/Java内存模型(JMM).html';">Java内存模型(JMM)</li><li onclick="location.href='java jvm android/Java动态代码生成方案理解.html';">Java动态代码生成方案理解</li><li onclick="location.href='java jvm android/Java并发概述.html';">Java并发概述</li><li onclick="location.href='java jvm android/LinkedHashMap理解.html';">LinkedHashMap理解</li><li onclick="location.href='java jvm android/MMKVl理解.html';">MMKVl理解</li><li onclick="location.href='java jvm android/MultiDex理解.html';">MultiDex理解</li><li onclick="location.href='java jvm android/React理解.html';">React理解</li><li onclick="location.href='java jvm android/RxJava理解.html';">RxJava理解</li><li onclick="location.href='java jvm android/TreeMap理解.html';">TreeMap理解</li><li onclick="location.href='java jvm android/volatile理解.html';">volatile理解</li><li onclick="location.href='java jvm android/手写React Native.html';">手写React Native</li><li onclick="location.href='java jvm android/插件化方案理解.html';">插件化方案理解</li><li onclick="location.href='java jvm android/热修复方案理解.html';">热修复方案理解</li><li onclick="location.href='java jvm android/第三方面试整理.html';">第三方面试整理</li></ul></li><li>jt<ul></ul></li><li>kotlin<ul><li onclick="location.href='kotlin/Kotlin语法糖理解.html';">Kotlin语法糖理解</li><li>META-INF<ul></ul></li></ul></li><li onclick="location.href='siteCol.html';">siteCol</li><li>thought works<ul><li onclick="location.href='thought works/Thought Works.html';">Thought Works</li></ul></li><li>tool<ul></ul></li><li>v2<ul><li onclick="location.href='v2/offer checker.html';">offer checker</li><li>pics<ul></ul></li><li onclick="location.href='v2/v2.html';">v2</li></ul></li><li onclick="location.href='事件流.html';">事件流</li><li>图说<ul></ul></li><li onclick="location.href='年终总结.html';">年终总结</li><li>思考与心态<ul><li onclick="location.href='思考与心态/2020-11.html';">2020-11</li><li>Plans<ul></ul></li><li onclick="location.href='思考与心态/生活探索.html';">生活探索</li><li onclick="location.href='思考与心态/还能做点什么.html';">还能做点什么</li></ul></li><li>操作系统<ul><li onclick="location.href='操作系统/多任务操作系统.html';">多任务操作系统</li></ul></li><li>测试<ul><li onclick="location.href='测试/MockResponse来进行AndroidTest.html';">MockResponse来进行AndroidTest</li><li onclick="location.href='测试/内存泄漏测试.html';">内存泄漏测试</li></ul></li><li>算法<ul><li onclick="location.href='算法/算法整理.html';">算法整理</li></ul></li><li>网络<ul><li onclick="location.href='网络/计算机网络.html';">计算机网络</li></ul></li><li>职场见解<ul><li onclick="location.href='职场见解/ 外部风险管理.html';"> 外部风险管理</li><li>@bd<ul><li onclick="location.href='职场见解/@bd/小程序学习与理解.html';">小程序学习与理解</li><li onclick="location.href='职场见解/@bd/感受与反思.html';">感受与反思</li></ul></li><li onclick="location.href='职场见解/专注过程与专注结果.html';">专注过程与专注结果</li><li onclick="location.href='职场见解/为什么研发的话语权这么低.html';">为什么研发的话语权这么低</li><li onclick="location.href='职场见解/风险管理与开发流程.html';">风险管理与开发流程</li></ul></li><li onclick="location.href='补码运算.html';">补码运算</li></ul>
          </div>
          <div id="reader" style="display: flex; flex-direction:column;flex-grow: 1; padding:20px">
          <h1>
<a id="user-content-事件流" class="anchor" href="#%E4%BA%8B%E4%BB%B6%E6%B5%81" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>事件流</h1>
<p>事件流 = { 开始事件 [中间事件...] 结束事件 }</p>
<p>事件 = { 时间点 事件描述 事件源 [所属页面,可见状态,成功,失败,取消] }</p>
<p>事件源(枚举) = { App, Activity, Window, Fragment, Input, Network, ImageLoad, Database, ViewTree }</p>
<p>对于所有的事件，都可以以事件流的形式进行考虑。</p>
<table>
<thead>
<tr>
<th>事件源</th>
<th>事件流模型</th>
</tr>
</thead>
<tbody>
<tr>
<td>App</td>
<td>OnCreate [...] OnDestroy</td>
</tr>
<tr>
<td>Activity</td>
<td>OnCreate [...] OnDestroy</td>
</tr>
<tr>
<td>Fragment</td>
<td>OnCreate [...] OnDestroy</td>
</tr>
<tr>
<td>Input</td>
<td>OnScrollStart [...] OnScrollStop</td>
</tr>
<tr>
<td>Input</td>
<td>OnTouchStart [...] OnTouchStop</td>
</tr>
<tr>
<td>Network</td>
<td>OnRequestStart [...] OnRequestFinish</td>
</tr>
<tr>
<td>ImageLoad</td>
<td>OnResourceLoadStart [...] OnResourceLoadFinish</td>
</tr>
</tbody>
</table>
<h2>
<a id="user-content-事件流图示" class="anchor" href="#%E4%BA%8B%E4%BB%B6%E6%B5%81%E5%9B%BE%E7%A4%BA" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>事件流图示</h2>
<p><a href="./%E4%BA%8B%E4%BB%B6%E6%B5%81Demo.svg" target="_blank" rel="noopener noreferrer"><img src="./%E4%BA%8B%E4%BB%B6%E6%B5%81Demo.svg" alt="" style="max-width:100%;"></a></p>
<ul>
<li>事件流之间不应该有引用、包含关系。它只是一个事情过程通过几个事件节点进行描述。它们之间的隐含关系应通过观察视图和分析挖掘得出。</li>
<li>事件流的观察方式有很多（实质上都是事件必备属性和可选属性的条件筛选）：
<ul>
<li>从自定义时间段选取事件流</li>
<li>从指定页面选取事件流</li>
<li>只关注某事件源的事件流</li>
<li>在某一时间段（如某一事件后到某一事件前）、在某一页面、满足某事件属性条件（如开始事件和结束事件都必须可见、且都在此页面上）的事件流</li>
</ul>
</li>
<li>事件流的构建具有良好的特性：
<ul>
<li>低侵入性。</li>
<li>事件源独立性。</li>
<li>可拓展性（可自定义虚拟的事件源，发送任何有意义的事件流）</li>
<li>API单一性。</li>
</ul>
</li>
<li>事件流本身仅是会话的描述和记录。后续的分析挖掘才可以满足各类分析场景使用。</li>
</ul>
<h2>
<a id="user-content-api设计" class="anchor" href="#api%E8%AE%BE%E8%AE%A1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API设计</h2>
<ul>
<li>类：
<ul>
<li>Event 事件对象
<ul>
<li>成员变量
<ul>
<li>long eventTime</li>
<li>EventSource eventSource</li>
</ul>
</li>
<li>EventSource 事件源枚举</li>
<li>子类
<ul>
<li>ApplicationEvent</li>
<li>ActivityEvent</li>
<li>FragmentEvent</li>
<li>ImageLoadEvent</li>
</ul>
</li>
</ul>
</li>
<li>EventStream 事件流对象
<ul>
<li>start(Event startEvent)</li>
<li>end(Event endEvent)</li>
<li>SingleEventStream 子类，后期可使用的单事件事件流</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>
<a id="user-content-事件流存储" class="anchor" href="#%E4%BA%8B%E4%BB%B6%E6%B5%81%E5%AD%98%E5%82%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>事件流存储</h2>
<p>内存 -&gt; 数据库</p>
<h2>
<a id="user-content-事件流分析" class="anchor" href="#%E4%BA%8B%E4%BB%B6%E6%B5%81%E5%88%86%E6%9E%90" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>事件流分析</h2>
<p>数据库Sql操作 -&gt; 自定义指标分析 -&gt; 分析结果上报</p>
<h2>
<a id="user-content-事件流eventflow-eventstream" class="anchor" href="#%E4%BA%8B%E4%BB%B6%E6%B5%81eventflow-eventstream" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>事件流EventFlow, EventStream</h2>
<p>为何需要事件流？当前开发模型的若干缺陷：</p>
<ul>
<li>点击事件，跳转路径无法捕获上下文来源，无法追踪上下文信息。而这些信息对于业务追踪会有很高的诉求。
我们处理点击事件只是在一个很小的范围（View自己的范围内一般）去做逻辑处理。跳转成功，或者触发成功响应的逻辑即可，但自身点击的上下文环境未知，比如是什么首页下的什么楼层的第几个，带有了怎样的促销id等等。
而跳转路径上下文未知就是，虽然我们经常会跳转到商详，但商详的统一Pv埋点，却无法衡量来源渠道。</li>
</ul>
<p>事件流模型是致力于解决此类缺陷的方案之一。它透明且轻巧。客观观察一切之后，再做实时的，亦或者是延后的分析。</p>
<p>ClickEvent 发生在了某个View， 从此View向上遍历ViewTree，探寻所有的TrackInfoNode（每个View树上的View节点，也通过Tag对应着TrackNode节点）。TrackNode包含了View中所有希望被记录的、被跟踪的数据。这些数据不是零散、离散的简单数据，因为这样并不便于解析使用。而是结构化的数据（XxxInfoNode, YyyInfoNode）。以此可以对应了统一抽象的解析方式。</p>
<p>通过</p>

          </div>
      </div>
  </body>
  
  </html>
    