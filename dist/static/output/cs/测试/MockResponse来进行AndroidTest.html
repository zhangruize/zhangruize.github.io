
  <!DOCTYPE html>
  <html>
  
  <head>
      <meta charset="utf-8" />
      <title>
          Zrek's blog
      </title>
      <style>
      li {
        cursor:pointer;
      }
      
      li:hover{
        background-color: #ffffff99;
      }
      
      code{
        background-color: #eee;
        padding:2px;
        display:inline-block;
      }
      
      pre{
        background-color: #eee;
        padding:10px;
        padding-left: 20px;
        padding-right: 20px;
      }
      </style>
  </head>
  
  <body style="background:#f7f7f7;">
      <div style="display:flex;width:100%;">
          <div>Zrek's blog</div>
      </div>
      <div style="display:flex;width:100%;">
          <div id="category" style="display: flex; flex-direction:column;background-color: antiquewhite; padding-right:20px; flex-shrink:0;">
          <ul><li onclick="location.href='../../cs/Activity启动模式理解.html';">Activity启动模式理解</li><li onclick="location.href='../../cs/ConcurrentHashMap理解.html';">ConcurrentHashMap理解</li><li onclick="location.href='../../cs/Dex文件理解.html';">Dex文件理解</li><li onclick="location.href='../../cs/Github&Gitlab-CI&CD理解.html';">Github&Gitlab-CI&CD理解</li><li onclick="location.href='../../cs/Glide理解.html';">Glide理解</li><li onclick="location.href='../../cs/HashMap理解.html';">HashMap理解</li><li onclick="location.href='../../cs/JVM内存模型.html';">JVM内存模型</li><li onclick="location.href='../../cs/Java内存模型(JMM).html';">Java内存模型(JMM)</li><li onclick="location.href='../../cs/Java动态代码生成方案理解.html';">Java动态代码生成方案理解</li><li onclick="location.href='../../cs/Java并发概述.html';">Java并发概述</li><li onclick="location.href='../../cs/Kotlin语法糖理解.html';">Kotlin语法糖理解</li><li onclick="location.href='../../cs/LinkedHashMap理解.html';">LinkedHashMap理解</li><li onclick="location.href='../../cs/MMKVl理解.html';">MMKVl理解</li><li onclick="location.href='../../cs/MultiDex理解.html';">MultiDex理解</li><li onclick="location.href='../../cs/React理解.html';">React理解</li><li onclick="location.href='../../cs/RxJava理解.html';">RxJava理解</li><li onclick="location.href='../../cs/TreeMap理解.html';">TreeMap理解</li><li onclick="location.href='../../cs/binder ipc原理.html';">binder ipc原理</li><li onclick="location.href='../../cs/knowledge tree.html';">knowledge tree</li><li>pics<ul></ul></li><li onclick="location.href='../../cs/v2.html';">v2</li><li onclick="location.href='../../cs/volatile理解.html';">volatile理解</li><li onclick="location.href='../../cs/手写React Native.html';">手写React Native</li><li onclick="location.href='../../cs/插件化方案理解.html';">插件化方案理解</li><li>操作系统<ul><li onclick="location.href='../../cs/操作系统/多任务操作系统.html';">多任务操作系统</li></ul></li><li onclick="location.href='../../cs/构建优化.html';">构建优化</li><li>测试<ul><li onclick="location.href='../../cs/测试/MockResponse来进行AndroidTest.html';">MockResponse来进行AndroidTest</li><li onclick="location.href='../../cs/测试/内存泄漏测试.html';">内存泄漏测试</li></ul></li><li onclick="location.href='../../cs/热修复方案理解.html';">热修复方案理解</li><li onclick="location.href='../../cs/第三方面试整理.html';">第三方面试整理</li><li onclick="location.href='../../cs/算法整理.html';">算法整理</li><li onclick="location.href='../../cs/补码运算.html';">补码运算</li><li onclick="location.href='../../cs/计算机网络.html';">计算机网络</li></ul>
          </div>
          <div id="reader" style="display: flex; flex-direction:column;flex-grow: 1; padding:20px">
          <p>最近一个同事提了个通过MockResponse来帮助测试一些不好进行实际网络请求的测试，感觉他的方案和思路都很有亮点，写个博文记录一下。</p>
<p>其思路是首先使用FileLogger这样一个OkHttp的拦截器把所有的请求和响应以json形式写入到手机本地文件上。再通过adb转移到项目的androidTest的asset目录下。此时可以通过测试用例的名字创建一个文件夹，再按某些名称规则标记刚才记录的json数据，从而可以按一个特定的顺序依次响应（主要是同一个请求下，前后顺序可能会敏感）。</p>
<p>每个测试用例在运行的时候，添加一个MockResponse的拦截器，另外还需要先加载对应的asset目录下的响应缓存文件，里面包含的request信息。此时可以覆盖MockResponse的方法，自定义一些逻辑决定此测试用例中okHttp发送的哪些请求会被MockResponse拦截，甚至决定如何使用这些缓存的数据。默认的话应该是Request的url只要匹配，同时缓存中尚还存在未被消耗的该url的Response，则会直接返回。</p>
<p>最后还可以检查该缓存文件所有数据是不都被消耗了，从而更加严格进行检查。</p>
<p>再总结一次：</p>
<ul>
<li>添加FileLogger手动操作一次正常流程。</li>
<li>把FileLogger记录的请求数据转移到项目的androidTest-&gt;asset中。</li>
<li>在测试用例中添加MockResponse拦截器，在测试用例开始时加载对应的缓存文件。</li>
<li>可自定缓存使用逻辑。或按默认自动返回缓存网络数据，原样模拟之前操作场景。</li>
<li>（可选）检查缓存数据是否全部被消耗完毕。</li>
</ul>

          </div>
      </div>
  </body>
  
  </html>
    